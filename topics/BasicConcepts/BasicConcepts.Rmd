---
title: "Basic Concepts in Missing Data"
author: "William Murrah"
output: html_document
bibliography: bibfile.bib
---

A great book to learn about dealing missing data an how to deal with it is *Applied Missing Data Analysis* [@enders2010applied], which covers full information maximum likelihood and multiple imputation.
Much of the material covered in this repository and accompanying tutorials is based on the book *Flexible Imputation of Missing Data* [@van2012flexible], particularly chapters 4-6.


```{r, include=FALSE}
# Don't delete this chunk if you are using the mosaic package
# This loads the mosaic and dplyr packages
require(mosaic)
```

```{r, include=FALSE}
# Some customization.  You can alter or delete as desired (if you know what you are doing).

# This changes the default colors in lattice plots.
trellis.par.set(theme=theme.mosaic())  

# knitr settings to control how R chunks work.
require(knitr)
opts_knit$set(root.dir = "../../")
opts_chunk$set(
  message = FALSE,
  comment = NULL,
  tidy=FALSE,     # display code as typed
  size="small"    # slightly smaller font for code
)
```


## Packages we will use:
```{r}
require(texreg)  
require(mice)
require(VIM)
```

## Notation we will use:

* $n$ = number of units (number of cases or people) indexed by $i$.
* $p$ = number of variables (including outcome and predictors), indexed by $j$.
* $Y$ = $n\times p$ matrix containing the data values for $p$ variables for $n$ units in the sample.
* $R$ = response indicator, a $n\times p$ matrix with each cell containing either a `0` or a `1`, where

$$
r_{ij} = 
\begin{cases}
  \text{1 if $y_{ij}$ is observed and,} \\
  \text{0 if $y_{ij}$ is missing.}
\end{cases} \tag{1}
$$

* $Y_{obs}$ = the observed data, collectively (i.e. contains all elements $y_{ij}$ where $r_{ij} = 1$).
* $Y_{mis}$ = the missing data, collectively (i.e. contains all elements $y_{ij}$ where $r_{ij} = 0$). 


```{r , echo=FALSE}
### define data sets pattern1-pattern4 with four patterns
set.seed(1234)
data <- matrix(data = sample(x = 1:100, 
                             size = 4*8*3, 
                             replace=TRUE), 
               nrow = 8*4,
               dimnames = list(NULL, 
                             c("A","B","C")))
data <- as.data.frame(data)
data[c(31:32),"A"] <- NA
data[c(15:16,22:24,30:32),"B"] <- NA
data[c(6:8,12:16,17:21,27:29),"C"] <- NA

mdpat <- cbind(expand.grid(rec = 8:1, pat = 1:4, var = 1:3), r=as.numeric(as.vector(is.na(data))))
mdpat2 <- 1 - is.na(data)
pattern1 <- data[1:8,]
pattern2 <- data[9:16,]
pattern3 <- data[17:24,]
pattern4 <- data[25:32,]
### Figure 4.1
types <-  c("Univariate","Monotone","File matching","General")
tp41 <- levelplot(r~var+rec|as.factor(pat), data=mdpat, 
                  as.table=TRUE, aspect="iso",
                  shrink=c(0.9), 
                  col.regions = mdc(1:2),
                  colorkey=FALSE,
                  scales=list(draw=FALSE),
                  xlab="", ylab="",
                  between = list(x=1,y=0),
                  strip = strip.custom(bg = "grey95", style = 1,
                                       factor.levels = types))
general <- pattern4
rownames(general) <- 1:8
```

\newpage

## Missing Data Patterns
```{r , echo = FALSE, fig.width=8, fig.height=5}

print(tp41)
```

```{r}

print(tp41[4])
```

## A simple data frame with some missing data:
```{r}
general
```

### Create an $R$ matrix
```{r}
R <- 1 - is.na(general)
R
```

```{r}
md.pattern(pattern4)

```



\newpage

## Session Information

```{r echo=FALSE}
sessionInfo()  # could use devtools::session_info() if you prefer that
```

## References